# Military-Grade Apache Logging Configuration
# Place this in /etc/apache2/conf-available/erp-logging.conf

# 1. Define Forensic Log Format
# %D: Request duration in microseconds
# %{X-Request-ID}i: Correlation ID from application/CDN
# %{SSL_PROTOCOL}x: TLS version for security audit
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %D %{X-Request-ID}o %{SSL_PROTOCOL}x %{SSL_CIPHER}x" erp_forensic

# 2. Smart Filtering (Reduce noise)
SetEnvIf Request_URI "^/health$" dontlog
SetEnvIf Request_URI "^/favicon.ico$" dontlog
SetEnvIf Request_URI "\.(?i:gif|jpe?g|png|ico|css|js)$" dontlog
SetEnvIf Request_URI "stream_logs\.php" dontlog

# 3. Apply Logging
CustomLog ${APACHE_LOG_DIR}/erp_access.log erp_forensic env=!dontlog

# 4. Error Granularity
# Production: warn | Security audit: info
LogLevel warn authz_core:info authn_core:info ssl:info
